# 标签描述更新脚本

## 概述

`update_label_descriptions.py` 脚本用于从 `label-desc.txt` 文件读取标签描述数据，并更新数据库中已存在的标签描述。

## 数据格式

`label-desc.txt` 文件格式：
- 奇数行：中文描述
- 偶数行：英文标签
- 空行会被自动过滤

示例：
```
服装/不合身
clothingNotFit
服装/尺寸咨询
askFitness
```

## 功能特性

1. **自动过滤空行**：忽略文件中的空白行
2. **安全更新**：只更新数据库中已存在的标签，不会创建新标签
3. **事务处理**：使用数据库事务，确保数据一致性
4. **详细统计**：提供完整的处理统计信息
5. **错误处理**：遇到错误时会回滚所有更改

## 使用方法

### 1. 在项目根目录运行：

```cmd
uv run scripts/update_label_descriptions.py
```

### 2. 或者激活虚拟环境后运行：

```cmd
.venv\Scripts\activate
python scripts/update_label_descriptions.py
```

## 输出示例

```
开始处理数据文件: scripts\label-desc.txt
数据库: sqlite:///./annotation.db
--------------------------------------------------
解析到 117 个标签-描述对
✓ 更新标签 'clothingNotFit' 的描述: '服装/不合身'
✓ 更新标签 'askFitness' 的描述: '服装/尺寸咨询'
⚠ 标签 'someLabel' 在数据库中不存在，跳过

✓ 成功提交所有更改到数据库

==================================================
处理结果统计:
总计处理: 117 个标签
成功更新: 115 个
未找到: 2 个
出错: 0 个

未找到的标签列表:
  - someLabel
  - anotherLabel
```

## 注意事项

1. 确保 `label-desc.txt` 文件存在于 `scripts/` 目录中
2. 脚本只会更新已存在的标签，不会创建新标签
3. 建议在运行前备份数据库
4. 如果行数不是偶数，最后一行会被忽略

## 错误处理

- 如果数据文件不存在，脚本会报错并退出
- 如果数据库连接失败，会显示错误信息
- 如果更新过程中出现错误，所有更改会被回滚 